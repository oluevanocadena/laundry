<modal [(show)]="show" [closeLabel]="'Cancelar'"
    [confirmLabel]="isMobileOrTablet ? 'Agregar producto' : 'Agregar producto a pedido'" [confirmStyle]="'success'"
    (onConfirm)="confirm()" (onClose)="close()" [busy]="busy" [disableConfirm]="canSave === false">
    <span title>
        Búsqueda de producto
    </span>

    <grid body [direction]="'row'" [gap]="[8,8]" padding="1rem 1.5rem">
        <grid [gap]="[8,8]" [direction]="'column'" [align]="'center-left'">
            <span class="f-14 fw-400 f-05 f-lh-15">
                ¿Qué producto vas a agregar al pedido?
            </span>
            <span class="material-symbols-outlined f-info f-16 pointer" nz-tooltip
                nzTooltipTitle="Algunos productos pueden no estar disponibles en la sucursal seleccionada del menú superior, revise la disponibilidad de los productos para cada sucursal.">
                info
            </span>
        </grid>
        <grid [direction]="'row'" [gap]="[16,16]" width="100%">
            <form [formGroup]="formGroup" width="100%">
                <grid [direction]="'row'" [gap]="[24,16]" width="100%" [padding]="'1rem 0 1rem 0'">
                    <form-input [type]="'search'" [placeholder]="'Comienza a escribir para buscar'"
                        formControlName="search" (onSearch)="facade.fetchProducts($event)" />

                    <!-- Busy -->
                    <grid *ngIf="busy" [direction]="'column'" [align]="'center-center'" [width]="'100%'">
                        <tui-loader [size]="'m'"></tui-loader>
                    </grid>

                    <ng-container *ngIf="products.length === 0 && busy === false">
                        <grid *ngIf="search.value" [gap]="[16,8]" [direction]="'row'" width="100%"
                            padding="0 0 0.5rem 0">
                            <span class="f-13 fw-400 f-02 f-lh-16">
                                No hay productos para mostrar o los criterios de búsqueda no arrojan resultados.
                            </span>

                            <grid [direction]="'column'" [align]="'center-left'" [gap]="[8,8]" width="100%"
                                padding="0 0 0.5rem 0">
                                <span class="material-symbols-outlined f-16 f-warning icon-fill">
                                    warning
                                </span>
                                <span class="f-13 fw-400 f-06 f-lh-16">
                                    Algunos productos
                                    <span class="f-13 fw-400 f-info  ">
                                        podrían no estar disponibles en la sucursal seleccionada
                                    </span>
                                    del menú superior, revise la disponibilidad de los productos para cada sucursal.
                                </span>
                            </grid>
                        </grid>

                        <grid *ngIf="!search.value" [direction]="'row'" [gap]="[16,16]" width="100%"
                            padding="0 0 0.5rem 0">
                            <span class="f-13 fw-400 f-06 f-lh-16">
                                Comience a escribir para buscar un producto.
                            </span>
                        </grid>
                    </ng-container>
                    <grid *ngIf="products.length > 0 && busy === false" [direction]="'row'" [gap]="[0,0]" width="100%"
                        [maxHeight]="isMobileOrTablet ? '300px' : '450px'" class="scroll-v">
                        <ng-container *ngFor="let product of products">
                            <button full medium flat flex [attr.selected]="isSelected(product)"
                                (click)="selectProduct(product)" class="brdr-bottom">
                                <grid [gap]="[0,16]" [direction]="'column'" [template]="'max-content 1fr max-content'"
                                    width="100%">
                                    <grid [padding]="'0.25rem 0 0.5rem 0'">
                                        <img src="{{product.ImageUrl}}" alt="{{product.Name}}" width="48" height="48"
                                            (error)="utils.onImageError($event)" class="brdr-radius-4 img-cover" />
                                    </grid>
                                    <orders-item-description [item]="product" />
                                    <grid [direction]="'column'" [align]="'top-right'" height="100%">
                                        <span class="f-13 fw-600 f-03">
                                            {{
                                            ProductsDomain.getPriceOfStore(product, sessionService)
                                            | numeralFormat: '$0,0.00'
                                            }}
                                        </span>
                                    </grid>
                                </grid>
                            </button>
                        </ng-container>
                    </grid>

                    <grid *ngIf="product" [direction]="'row'" [gap]="[16,16]" width="100%" padding="0 0 0 0">
                        <form-input [label]="'Cantidad'"
                            [type]="product.UnitMeasure?.UnitType === 'decimal' ? 'decimal' : 'number'"
                            [placeholder]="'Cantidad'" formControlName="quantity"
                            [min]="product.UnitMeasure?.UnitType === 'decimal' ? 0.01 : 1" [postFix]="postFixText" />

                    </grid>
                </grid>
            </form>
        </grid>
    </grid>
</modal>